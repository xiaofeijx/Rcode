---
title: "网络报告数据检查"
output: html_document
---



```{r echo=FALSE}
library(dplyr)
df <- read.csv("Report.csv",skip=2,header=T,stringsAsFactors=F,na.strings = ".")
#head(df)
str(df)
df[,18] <- as.POSIXct(df[,18])
df[,19] <- as.POSIXct(df[,19],format="%Y-%m-%d %H:%M:")
df[,26] <- as.POSIXct(df[,26])
df[,30] <- as.POSIXct(df[,30],format="%Y-%m-%d %H:%M:")
df[,33] <- as.POSIXct(df[,33],format="%Y-%m-%d %H:%M:")
df[,34] <- as.POSIXct(df[,34],format="%Y-%m-%d %H:%M:")
df[,35] <- as.POSIXct(df[,35],format="%Y-%m-%d %H:%M:")
df[,37] <- as.POSIXct(df[,37],format="%Y-%m-%d %H:%M:")
df[,38] <- as.POSIXct(df[,38],format="%Y-%m-%d %H:%M:")
#nchar(df[,9])
df$age <- ifelse(substr(df[,9],nchar(df[,9]),nchar(df[,9]))=="岁",
              as.numeric(substr(df[,9],1,nchar(df[,9])-1)),
              as.numeric(substr(df[,9],1,nchar(df[,9])-1))/12)

```
##报告病种统计
```{r echo=FALSE}
df_df <- group_by(df,疾病名称)
summarise(df_df,数量=n())
```

甲类与甲类传染病报告时限检查>=2小时
```{r}
classone <- df[,21] %in% c("鼠 疫","霍 乱","传染性非典","脊 灰","肺炭疽")
df[difftime(df[,30],df[,19],units="hours") >= 2 & classone, c(4,7,9,14,19,21,28)]
```

所有报告疾病报告时限检查>=24小时
```{r, echo=FALSE}
df[difftime(df[,30],df[,19],units="days") >= 1, c(4,7,9,14,19,21,28)]
```

订正报告卡时限检查（含甲乙类）
```{r}
modifieddf <- df[!is.na(df[,37]),]
mclassone <- modifieddf[,21] %in% c("鼠 疫","霍 乱","传染性非典","脊 灰","肺炭疽")
modifieddf[difftime(modifieddf[,38],modifieddf[,37],units="hours") >= 2 & mclassone, c(4,7,9,14,19,21,28)]

modifieddf[difftime(modifieddf[,30],modifieddf[,19],units="days") >= 1, c(4,7,9,14,19,21,28)]
```




年龄与职业关系
职业与单位

病种与分类的关系
